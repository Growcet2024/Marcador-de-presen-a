<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Cabe√ßalho da P√°gina -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcador de presen√ßa</title>

    <!-- Mapa na tela -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>

body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #02779eE6; /* cor do fundo fora do container */
    color: #333;
}

body{
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}


        /* Estilos do Cabe√ßalho */
header {
    text-align: left;
    padding: 5px 10px 50px 10px; /* padding-top: 5px; padding-right:10px; padding-bottom:50px; padding-left:10px */
    background-color: #02779e; /* Cor do heder barra topo*/
    color: #fdfefe; /* Cor titulo Checkin+*/
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1;
    box-shadow: 0 8px 8px #0000001A;

     border-bottom: 20px solid #99c2ec; /* Linha inferior para separar o cabe√ßalho */
}


 /* CSS COR CONTEIN PRINCIPAL*/
.container {
    max-width: 600px;          /* Limita a largura m√°xima da container para 600px */
    width: calc(100% - 10px);  /* Subtrai 10px (5px √† esquerda + 5px √† direita) */
    margin-left: 5px;          /* Margem de 5px √† esquerda */
    margin-right: 5px;         /* Margem de 5px √† direita */
    padding: 10px;
    background-color: #f0f4f8;
    box-shadow: 0 4px 8px #0000001A;
    border-radius: 15px;
    position: relative;
    z-index: 2;
    display: block;
    box-sizing: border-box;
}

/* Centraliza√ß√£o */

        /* IMPUT - √Årea de Texto (Descri√ß√£o) */
        textarea, input[type="text"] {
            width: 100%;
            padding: 10px !important;  /* afastar o texto das bordas */
            height: 40px;              /* ajuste a altura para manter o tamanho original */
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 10px;
            resize: none;
            font-size: 14px;
            box-sizing: border-box;
            background-color: #f0f7ff; /* üëà Fundo secund√°rio */
        }

/* =========================
   Bot√µes padronizados com efeito glossy e centralizados
   ========================= */
button {
    width: 90%;                   /* Largura menor que 100% */
    display: block;               /* Garante que margin auto funcione */
    margin: 15px auto;            /* Centraliza horizontalmente + espa√ßamento vertical */
    padding: 10px;                /* Mant√©m altura do bot√£o */
    border: 2px solid #5fa5b4;   /* Borda fina moderna */
    border-radius: 25px;          /* Arredondado */
    font-size: 16px;              /* Tamanho da fonte */
    font-weight: bold;            /* Peso da fonte */
    cursor: pointer;
    position: relative;           /* Necess√°rio para o efeito glossy */
    overflow: hidden;             /* Brilho n√£o vaza */
    color: white;                 /* Cor do texto */
    background: linear-gradient(to bottom, #02779e, #02779e); /* Gradiente base */
    transition: background 0.3s, transform 0.2s;
    box-sizing: border-box;
}



 /* Adicionando o CSS da bolha */
        .bubble { 
            position: absolute;
            width: 80px; /* Tamanho da bolinha (largura) */
            height: 80px; /* Tamanho da bolinha (altura) */
            border-radius: 50%; /* Para manter a bolinha redonda */
            pointer-events: none;

           /* Lente */
           border: 2px solid #000000BF; /* Branco com 75% de opacidade */
           box-shadow:
           inset 0 0 5px #ffffff99,   /* Branco com 60% de opacidade */
           0 0 5px #ffffff59;        /* Branco com 35% de opacidade */

            /* Zoom percept√≠vel */
            backdrop-filter: zoom(3.5);
        }












<!-- Estilos CSS -->
    </style>

    

    <!-- seu conte√∫do HTML aqui -->


<script>

window.addEventListener('load', function() {
    const header = document.querySelector('header');
    const container = document.querySelector('.container');

    const ajuste = -35; // valor negativo faz o container subir sobre o header
    container.style.marginTop = (header.offsetHeight + ajuste) + 'px';
});

</script>





<script>
    /* Vari√°veis Globais */
    let currentLatitude = "-";
    let currentLongitude = "-";
    let userName = "Usu√°rio Logado";

    /* Fun√ß√µes JavaScript */


// BLOCO-2
function checkUserName() {
    const savedUserName = localStorage.getItem("userName");
    const savedUserID = localStorage.getItem("userID");

    if (savedUserName && savedUserID) {

        // Mostra dados do usu√°rio
        document.getElementById("user-name").style.display = "none";
        document.getElementById("user-name-display").style.display = "inline";
        document.getElementById("user-name-display").innerText =
            `Usu√°rio: ${savedUserName} (ID: ${savedUserID})`;

        // Bot√µes
        document.getElementById("save-name-button").style.display = "none";
        document.getElementById("edit-name-button").style.display = "inline";

        // üîí ID N√ÉO √â EDIT√ÅVEL (garantia de seguran√ßa)
        const editIdBtn = document.getElementById("edit-id-button");
        if (editIdBtn) editIdBtn.style.display = "none";

    } else {

        // Primeiro acesso (sem nome salvo)
        document.getElementById("user-name").style.display = "inline";
        document.getElementById("save-name-button").style.display = "inline";
        document.getElementById("edit-name-button").style.display = "none";

        const editIdBtn = document.getElementById("edit-id-button");
        if (editIdBtn) editIdBtn.style.display = "none";
    }
}


    // Fun√ß√£o para obter o endere√ßo a partir das coordenadas
    function getAddressFromCoordinates(latitude, longitude) {
        const apiUrl = `https://us1.locationiq.com/v1/reverse?key=pk.73c7ec951f7e0c38e842f740a1a63917&lat=${latitude}&lon=${longitude}&format=json`;

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                const roadName = data.address.road || "N/A";
                const address = `Local: ${roadName},
                                 Bairro: ${data.address.residential || "N/A"},
                                 Regi√£o: ${data.address.suburb || "N/A"},
                                 Cidade: ${data.address.city || "N/A"},
                                 Estado: ${data.address.state || "N/A"},
                                 CEP: ${data.address.postcode ? data.address.postcode.substring(0, 5) : "N/A"},
                                 Pa√≠s: ${data.address.country || "N/A"}`;

                document.getElementById("road-name").innerText = `Local: ${roadName}`;
                document.getElementById("address").innerText = address;
            })
            .catch(error => {
                console.error("Erro ao obter endere√ßo:", error);
                document.getElementById("road-name").innerText = "Erro ao obter nome da rua.";
                document.getElementById("address").innerText = "Erro ao obter endere√ßo.";
            });
    }



function initDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);

        request.onupgradeneeded = (event) => {
            const database = event.target.result;


            if (!database.objectStoreNames.contains(STORE_NAME)) {
                database.createObjectStore(STORE_NAME, {
                    keyPath: "id",
                    autoIncrement: true
                });
            }
        };


        request.onsuccess = (event) => {
            db = event.target.result;
            resolve(db);
        };

// ===== Notifica√ß√£o armazenamento cheio =====
        request.onerror = (event) => {
    const err = event.target.error;

    if (err && err.name === "QuotaExceededError") {
        const msg = document.getElementById("saveMessage");
        if (msg) msg.innerText = "Armazenamento cheio. Limpe os dados do site.";
        msg.style.textAlign = "center";
        msg.style.color = "red";
    }
    // Cor da mensagem üëà

    reject(err);
};
});
}


// Fun√ß√£o para salvar o registro üëà
    async function saveRecord() {

    
//  ===== SALVAR TAMB√âM NO INDEXEDDB  =====

    const saveButton = document.querySelector("button[onclick='saveRecord()']");
    saveButton.innerText = "Registro salvo com sucesso!";
    setTimeout(() => {
        saveButton.innerText = "Salvar Registro";
    }, 2000);
}


   // Bloco= 1 inicio  Carregando mapa com atrazo projeto 42
              
   // Fun√ß√£o para carregar a localiza√ß√£o
function trackLocation() {
    // Exibe o GIF de carregamento assim que come√ßamos a buscar a localiza√ß√£o
    showLoading();

    // Esconde o mapa antes de come√ßar
    document.getElementById("map").style.display = 'none';


    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                currentLatitude = position.coords.latitude;
                currentLongitude = position.coords.longitude;

                const timestamp = new Date().toLocaleString();

                document.getElementById("coordinates").innerText =
                    `Latitude: ${currentLatitude}\nLongitude: ${currentLongitude}`;
                document.getElementById("timestamp").innerText = timestamp;

                getAddressFromCoordinates(currentLatitude, currentLongitude);


                // Agora, exibe o mapa
                document.getElementById("map").style.display = 'block';

                // Inicializa o mapa com as coordenadas obtidas
                map = L.map('map').setView([currentLatitude, currentLongitude], 15);



              
                // Ajuste para o mapa abrir no firebase

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    crossOrigin: true
}).addTo(map);



// Adiciona o marcador e a popup Mapa
            
const userName = localStorage.getItem("userName") || "Usu√°rio";

// Fun√ß√£o para converter metros em pixels baseado no zoom do mapa
function metersToPixels(meters, lat, map) {
    const pointC = map.latLngToContainerPoint([lat, 0]);
    const pointX = map.latLngToContainerPoint([lat, meters / 111320]); // 1 grau ~ 111.32 km
    return Math.abs(pointX.x - pointC.x);
}

// Obtem a posi√ß√£o do usu√°rio
navigator.geolocation.getCurrentPosition((position) => {
    const currentLatitude = position.coords.latitude;
    const currentLongitude = position.coords.longitude;
    let gpsAccuracy = position.coords.accuracy;

    // Limita o raio do c√≠rculo para n√£o ficar muito grande- tamanho
    if (gpsAccuracy > 19) gpsAccuracy = 19; // Tamanho do circulo

    // --- Pin HTML tamanho ---
    const htmlPin = L.divIcon({
        html: `<div style="
            width: 5px;
            height: 5px;
            background: #007BFF;
            border-radius: 50%;
            border: 2px solid #0056b3;
        "></div>`,
        className: '',
        iconSize: [12, 12],
        iconAnchor: [6, 6]
    });


    // --- C√≠rculo de precis√£o HTML ---
    function addAccuracyCircle() {
        const pixelRadius = metersToPixels(gpsAccuracy, currentLatitude, map);


        // Remove c√≠rculo antigo se houver
        if (window.accuracyMarker) map.removeLayer(window.accuracyMarker);

        window.accuracyMarker = L.marker([currentLatitude, currentLongitude], { icon: htmlCircle }).addTo(map);
    }

    // Centraliza o mapa na posi√ß√£o do usu√°rio
    map.setView([currentLatitude, currentLongitude], 16);
});



                // Corrige o redimensionamento do mapa ap√≥s a exibi√ß√£o
                map.invalidateSize();

                // Esconde o GIF de carregamento ap√≥s o mapa ser exibido
                hideLoading();
            },
            (error) => {
                console.error("Erro ao obter localiza√ß√£o:", error);
                document.getElementById("coordinates").innerText = "Erro ao obter localiza√ß√£o.";
                playSound("error-sound.mp3");

                // Esconde o GIF de carregamento em caso de erro
                hideLoading();
            }
        );
    } else {
        alert("Geolocaliza√ß√£o n√£o √© suportada neste navegador.");
        hideLoading(); // Garante que o GIF seja escondido em caso de erro
    }
}

// Chama a fun√ß√£o trackLocation quando a p√°gina for carregada
window.onload = function () {
    trackLocation();
};


// Fun√ß√£o para exibir o GIF de carregamento
function showLoading() {
    document.getElementById("loadingImage").style.display = 'block'; // Exibe o GIF de carregamento
}

// Fun√ß√£o para esconder o GIF de carregamento
function hideLoading() {
    document.getElementById("loadingImage").style.display = 'none'; // Esconde o GIF de carregamento
}

</script>
</head>
<body>




    <!-- Cabe√ßalho Tela principal-->
    <header>

  <h1 style="text-align: left; font-size: 22px; margin-top: 20px; margin-bottom: 10px;">
    Checkin+
  </h1>

    </header>

    <!-- Inicio conteiner=1 principal -->
    <!-- Container Principal -->
    <div class="container">


   <!-- Div da bolha dentro do container -->
    <div class="bubble"></div>






        <h2 style="width: 90%; margin: 15px auto; text-align: left; font-size: 15px; color: #000;">
        Marcador de presen√ßa üìç
        </h2>

        <!-- Nome da Rua -->
        <h2 id="road-name" style="width: 90%; margin: 10px auto; text-align: left; font-size: 15px; color: #000;">
        Rua: Local Carregando!
        </h2>

        <!-- Boco Mapa tipo iFrame -->
          <!-- Exibindo o GIF de carregamento antes de carregar o mapa -->
 <div id="loadingImage" style="text-align: center;">
    <img src="https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif" alt="Carregando..." style="width: 100px; height: 100px;">
</div>

  

  <!-- Local do mapa OpenStreetMap -->
        <div id="map" style="width: 100%; height: 300px;"></div>


   


    <!-- Borda em volta conteudo -->
           <div class="info-container" style="border: 1px solid #ccc; padding: 15px; border-radius: 8px; margin-top: 20px; margin-bottom: 20px;">

    <!-- Atualizar p√°gina -->
    <a href="index.html" class="btn-voltar">Atualizar mapa üîÑ</a>

     <!-- Alerta ativar localiza√ß√£o -->
    <div id="alerta-gps" style="display: none; background-color: #ffffff; color: #000; padding: 10px; text-align: center; font-weight: bold;">
        ‚ö†Ô∏è Ative a localiza√ß√£o
    </div>

    <!-- Coordenadas -->
    <div class="field">
        <h2>Coordenadas</h2>
        <p id="coordinates">Latitude: -, Longitude: -</p>
    </div>

    <!-- Data e Hora -->
    <div class="field">
        <h2>Data e Hora</h2>
        <p id="timestamp">Local</p>
    </div>

    <!-- Endere√ßo -->
   <div class="field" style="margin-bottom: 0;">
    <h2>Endere√ßo</h2>
   <p id="address" style="margin-bottom: 0;">Local</p>
     </div>
</div>


  <!-- Movendo o campo de descri√ß√£o e o bot√£o "Salvar Registro" acima do bot√£o Compartilhar -->
        <div class="description-container">
            <textarea id="description" placeholder="Adicione uma descri√ß√£o (opcional)"></textarea>
            <button class="button" onclick="saveRecord()">Salvar Registro</button>
        </div>
        
        <!--Notifica√ß√£o armazenamento cheio-->
        <div id="saveMessage" style="margin-top:8px; font-size:14px;"></div>


        <!-- Declara√ß√£o de comparecimento na tela -->

    <p class="copyright" style="width: 91%; margin: 10px auto; text-align: left; font-size: 14px; color: #000;">
  J√° precisou provar ao chefe que foi ao m√©dico?<br>
  Precisa provar sua presen√ßa e perman√™ncia em um local?<br>
  Vai precisar provar aos pais que est√° na escola?<br>

<hr style="width: 75%; margin: 10px auto; border: 1px solid #ccc;">

<p class="copyright" style="width: 91%; margin: 10px auto; text-align: left; font-size: 14px; color: #000;">
  Com o <strong>Checkin+</strong>, voc√™ registra sua presen√ßa com apenas um clique.  
  O app gera um comprovante de chegada e sa√≠da, e uma declara√ß√£o de comparecimento com nome, ID, data, hora e localiza√ß√£o ‚Äî uma prova incontest√°vel, em texto ou PDF, pronta para enviar, baixar ou imprimir.
</p>


        <!-- Chegada / Saida -->
        <button class="button" onclick="openArrivalDeparture()">Chegada / Sa√≠da</button>

        <!-- Bot√£o para Exibir o Hist√≥rico dentro do mesmo container -->
        <button class="button" onclick="toggleHistory()">Hist√≥rico de Presen√ßa</button>





<!-- PARTE DO HIST√ìRICO -->
<!-- Inicio conteine=2 hist√≥rico -->
<!-- Container para Exibir o Hist√≥rico de Presen√ßa -->
<div id="history-container" style="display: none;">
    <h3><center>Meu hist√≥rico</h3>
    <div id="records-list" style="background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); overflow-y: auto; padding: 10px;">
        <!-- Lista de registros ser√° carregada aqui -->
    </div>
</div>

<!-- Fim conteine=2 hist√≥rico -->


<!-- BLOCO Input NOME USU√ÅRIO -->
<div style="padding: 10px; max-width: 600px; margin: auto; margin-top: 20px;">

    <!-- Input do Nome (usado s√≥ quando N√ÉO existe nome salvo ou ao editar) -->
    <input type="text" id="user-name" placeholder="Digite seu nome">

    <!-- Nome exibido + √≠cone editar -->
    <div style="display: flex; align-items: center; justify-content: space-between; width: 95%; margin: 10px auto 0;">

        <!-- Nome + ID exibidos -->
        <span id="user-name-display" style="font-weight: bold; display: none;"></span>

        <!-- √çcone editar nome -->
        <i id="edit-name-button"
           onclick="editUserName()"
           class="fas fa-pencil-alt"
           style="font-size: 18px; color: #02779e; cursor: pointer; display: none;">
        </i>

    </div>

    <!-- Bot√£o Salvar Nome -->
    <button id="save-name-button"
            onclick="saveUserName()"
            class="button"
            style="width: 95%; padding: 10px; margin: 10px; border-radius: 15px; background-color: #28a749;">
        Salvar
    </button>

</div>
      <!-- Fim conte√∫do conteiner principal -->






<script>
        // Script da bolha
        document.addEventListener("DOMContentLoaded", function () {
            const bubble = document.querySelector('.bubble');

            // Posi√ß√£o inicial
            let x = Math.random() * (window.innerWidth - 80); // Posi√ß√£o aleat√≥ria horizontal, ajustada para o tamanho da bolha (80px)
            let y = Math.random() * (window.innerHeight - 80); // Posi√ß√£o aleat√≥ria vertical, ajustada para o tamanho da bolha (80px)

            // Velocidade da bolha (VX e VY)
            let vx = (Math.random() - 0.5) * 2; // Velocidade horizontal (ajuste o valor 2 para controlar a velocidade)
            let vy = (Math.random() - 0.5) * 2; // Velocidade vertical (ajuste o valor 2 para controlar a velocidade)


            // Fun√ß√£o para atualizar a posi√ß√£o da bolha
            function updateBubblePosition() {
                x += vx; // Atualiza a posi√ß√£o X com a velocidade VX
                y += vy; // Atualiza a posi√ß√£o Y com a velocidade VY

                // Verifica as colis√µes com as bordas
                  // Se a bolha encostar na borda esquerda ou direita, inverte a dire√ß√£o horizontal (VX)
                if (x <= 0 || x >= window.innerWidth - 80) vx *= -1; // Ajuste o 80 para o tamanho da bolha
                  // Se a bolha encostar na borda superior ou inferior, inverte a dire√ß√£o vertical (VY)
                if (y <= 0 || y >= window.innerHeight - 80) vy *= -1; // Ajuste o 80 para o tamanho da bolha


                // Atualiza a posi√ß√£o da bolha no DOM
                bubble.style.transform = `translate(${x}px, ${y}px)`; // Aplica a nova posi√ß√£o X e Y da bolha
            }

            // Anima√ß√£o cont√≠nua
            function animate() {
                updateBubblePosition();         // Atualiza a posi√ß√£o da bolha a cada frame
                requestAnimationFrame(animate); // Chama novamente a fun√ß√£o de anima√ß√£o no pr√≥ximo frame
            }

            animate();
        });
    </script>

</body>
</html>





